<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Twitch Alerter @ peti</title>
</head>
<body>
    <center><h1>Peti cucca jelez neked :)</h1></center>
    <p>
        <center><span style="display: block; width: 55px;">Statusz:</span>
        <span class="online" style="display:none; color:green">Online</span>
        <span class="offline" style="display:block; color:red">Offline</span></center>
    </p>
    <script src="/js/jquery.min.js" type="text/javascript" language="javascript" charset="utf-8"></script>
    <script src="/js/pushstream.js" type="text/javascript" language="javascript" charset="utf-8"></script>
    <script type="text/javascript" language="javascript" charset="utf-8">
    // <![CDATA[
    
    window.onload = notifyMe("");

    function messageReceived(text, id, channel) {
    var currentdate = new Date(); 
    var datetime = currentdate.getHours() + ":"  
                + currentdate.getMinutes() + ":" 
                + currentdate.getSeconds();
      notifyMe(datetime + " - " + text);
    };

    function _statuschanged(state) {
      if (state == PushStream.OPEN) {
        $(".offline").hide();
        $(".online").show();
      } else {
        $(".offline").show();
        $(".online").hide();
      }
    };
    
    function notifyMe(text) {
      if (!("Notification" in window)) {
        alert("This browser does not support desktop notification");
      }

      else if (Notification.permission === "granted" && text !== "") {
        var notification = new Notification(text);
        notification.onshow = function() {  setTimeout(function(){notification.close();},4000) }
      }

      else if (Notification.permission === "granted" && text === "") {
        var notification = new Notification("Peti cucca mostantól figyel!");
        notification.onshow = function() {  setTimeout(function(){notification.close();},4000) }
      }

      else if (Notification.permission !== 'denied') {
        Notification.requestPermission(function (permission) {

          if(!('permission' in Notification)) {
            Notification.permission = permission;
          }

          // If the user is okay, let's create a notification
          if (permission === "granted") {
            var notification = new Notification("Peti cucca mostantól értesíteni fog!");
            notification.onshow = function() {  setTimeout(function(){notification.close();},4000) }
          }
        });
      }
    }

    PushStream.LOG_LEVEL = 'debug';
    var pushstream = new PushStream({
      host: 'push.peti.ml',
      port: window.location.port,
      modes: "longpolling"
    });
    pushstream.onmessage = messageReceived;
    pushstream.onstatuschange = _statuschanged;
    pushstream.addChannel('streams');
    pushstream.connect();
    // ]]>
    </script>
</body>
</html>